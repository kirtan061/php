<?php
/* =========================================
   SINGLE FILE FORGOT PASSWORD MAIL SCRIPT
   ========================================= */

$status = "";

/* ---------- SEND MAIL ---------- */
if (isset($_POST['send_mail'])) {

    $email = $_POST['email'];

    // Generate token
    $token = md5(rand());

    // Reset link (same file)
    $reset_link = "http://localhost/forgot_password.php?token=$token";

    // Mail details
    $to = $email;
    $subject = "Forgot Password Recovery Mail";

    $message  = "Hello User,\n\n";
    $message .= "You requested to reset your password.\n";
    $message .= "Click the link below to reset your password:\n\n";
    $message .= $reset_link . "\n\n";
    $message .= "If you did not request this, please ignore this email.";

    $headers = "From: admin@example.com";

    // Send mail
    if (mail($to, $subject, $message, $headers)) {
        $status = "✔ Recovery mail sent successfully!";
    } else {
        $status = "✖ Mail sending failed!";
    }
}

/* ---------- TOKEN VERIFICATION ---------- */
if (isset($_GET['token'])) {
    $status = "✔ Token verified. User can reset password.";
}
?>

<!DOCTYPE html>
<html>
<head>
    <title>Forgot Password</title>
</head>
<body>

<h2>Forgot Password Recovery</h2>

<form method="post">
    Enter Email:
    <input type="email" name="email" required>
    <br><br>
    <input type="submit" name="send_mail" value="Send Recovery Mail">
</form>

<p style="color:green;"><?php echo $status; ?></p>

</body>
</html>
